{"version":3,"sources":["../src/index.js"],"names":["_setting","JSONdb","_logger","Logger","_filePaths","FilePaths","_ipcRenderer","electron","ipcRenderer","_puppeteerConfig","headless","width","height","args","_puppeteerWrapper","PuppeteerWrapper","scrapedData","main","setPlatformText","text","get","on","e","preventDefault","console","log","html","removeClass","addClass","searchQuery","val","searchLimit","parseInt","send","attr","GMapScrapper","cleanup","removeAttr","target","loadWebViewPage","email","key","validateLicense","os","type","platform","arch","release","getMacAddress","interfaces","networkInterfaces","macAddress","hasOwnProperty","wirelessNetwork","forEach","ifcs","toUpperCase","licenseKey","signature","undefined","signatureParams","hostname","signatureHash","set","baseUrl","licenseServerUrl","response","axios","licenseData","data","status","ex","getPageData","url","page","goto","waitForSelector","shopName","$eval","cssSelector","name","textContent","reviewRating","rating","reviewCount","review","exception","error","address","$$eval","divs","Array","from","map","div","innerText","find","timeout","website","link","test","phone","latLong","getLatLong","workHours","getWorkHours","images","getImages","allReviews","getReviews","returnObj","shop","trim","reviews","replace","latitude","longitude","main_image","all_images","all_reviews","click","waitForNavigation","waitUntil","newScrollHeight","scrollHeight","divSelector","evaluate","document","querySelector","scrollTo","waitForTimeout","getComputedStyle","backgroundImage","btnTriggerSelector","author","avatar","getAttribute","date","format","tableSelector","getLinks","searchResults","querySelectorAll","el","href","filter","match","latLongStartIndex","indexOf","latLongEndIndex","latLongData","substring","split","webview","getElementById","loadURL","removeEventListener","addEventListener","maxLinks","newPage","gmapInitUrl","Date","now","headers","reload","delay","keyboard","press","allLinks","linkCount","elements","some","push","length","uniqueLinks","value","index","self","slice","no","successCount","failedCount","empty","append","range","doneMessage","event","arg","chromeSet","setup","_getSavedPath","logError","logInfo","exportLogs","logsPath"],"mappings":"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","file":"index.js","sourcesContent":["//#region Imports\r\n// Library ----------------------------------------------------------------------------------\r\nimport electron from 'electron';\r\nimport { Logger } from './lib/logger';\r\nimport { FilePaths } from './lib/file-paths.js';\r\nimport { PuppeteerWrapper } from './lib/puppeteer-wrapper';\r\nimport { CSS_SELECTOR as cssSelector } from './config';\r\nimport $ from 'jquery';\r\nimport JSONdb from 'simple-json-db';\r\nimport axios from 'axios';\r\nimport delay from 'delay';\r\nimport os from 'os';\r\nimport md5 from 'md5';\r\nimport datejs from 'date.js';\r\nimport moment from 'moment';\r\n//#endregion\r\n\r\n//#region Setup - Dependency Injection-----------------------------------------------\r\nconst _setting = new JSONdb('./settings.json');\r\nconst _logger = new Logger();\r\nconst _filePaths = new FilePaths(_logger, \"gmap-scrapper\");\r\nconst _ipcRenderer = electron.ipcRenderer;\r\nconst _puppeteerConfig = { headless: false, width: 900, height: 650, args: ['--lang=en-EN,en'] };\r\nconst _puppeteerWrapper = new PuppeteerWrapper(_logger, _filePaths, _puppeteerConfig);\r\nlet scrapedData = [];\r\n//#endregion\r\n\r\n//#region Main ---------------------------------------------------------------------\r\n\r\nasync function main() {\r\n\tawait setPlatformText();\r\n\r\n\t$('#licenseToText').text(_setting.get('user_email'));\r\n\r\n\t$('#searchBtn').on('click', async (e) => {\r\n\t\te.preventDefault();\r\n\r\n\t\tconsole.log('Mulai');\r\n\r\n\t\t$('table tbody').html('<tr><td class=\"text-center\" colspan=\"9\">Hasil pencarian kosong</td></tr>');\r\n\t\t$('#statusTxt').removeClass('text-danger').removeClass('text-warning').addClass('text-success').text('Ready');\r\n\t\t$('#resultCountText').text('0');\r\n\r\n\t\tconst searchQuery = $('input#searchBusiness').val();\r\n\t\tconst searchLimit = parseInt($('select#searchLimit').val());\r\n\r\n\t\tif (searchQuery == \"\") {\r\n\t\t\t_ipcRenderer.send('empty-search-query', 'Kata kunci pencarian kosong.');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t$('input#searchBusiness').attr('disabled', 'disabled');\r\n\t\t$('input#searchLimit').attr('disabled', 'disabled');\r\n\r\n\t\tawait GMapScrapper(searchQuery, searchLimit);\r\n\t});\r\n\r\n\t$('#stopBtn').on('click', async (e) => {\r\n\t\te.preventDefault();\r\n\r\n\t\tawait _puppeteerWrapper.cleanup();\r\n\r\n\t\t$('#searchBtn').removeAttr('disabled');\r\n\t\t$(e.target).attr('disabled', 'disabled');\r\n\t\t$('#restartBtn').attr('disabled', 'disabled');\r\n\r\n\t\t$('input#searchBusiness').removeAttr('disabled');\r\n\t\t$('input#searchLimit').removeAttr('disabled');\r\n\t});\r\n\r\n\t$('#restartBtn').on('click', async (e) => {\r\n\t\te.preventDefault();\r\n\r\n\t\t$('table tbody').html('<tr><td class=\"text-center\" colspan=\"9\">Hasil pencarian kosong</td></tr>');\r\n\t\t$('#statusTxt').removeClass('text-danger').removeClass('text-warning').addClass('text-success').text('Ready');\r\n\t\t$('#resultCountText').text('0');\r\n\r\n\t\tawait _puppeteerWrapper.cleanup();\r\n\r\n\t\tconst searchQuery = $('input#searchBusiness').val();\r\n\t\tconst searchLimit = parseInt($('select#searchLimit').val());\r\n\r\n\t\tif (searchQuery == \"\") {\r\n\t\t\t_ipcRenderer.send('empty-search-query', 'Kata kunci pencarian kosong.');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tawait GMapScrapper(searchQuery, searchLimit);\r\n\t});\r\n\r\n\t$('#exportBtn').on('click', async (e) => {\r\n\t\t_ipcRenderer.send('export-to-xlsx', scrapedData);\r\n\t});\r\n\r\n\t$('#clearBtn').on('click', async (e) => {\r\n\t\t$('table tbody').html('<tr><td class=\"text-center\" colspan=\"9\">Hasil pencarian kosong</td></tr>');\r\n\t\t$('#statusTxt').removeClass('text-danger').removeClass('text-warning').addClass('text-success').text('Ready');\r\n\t\t$('#resultCountText').text('0');\r\n\r\n\t\tawait loadWebViewPage(\"https://www.google.com/maps/\");\r\n\t});\r\n\r\n\t$('#licenseForm').on('submit', async (e) => {\r\n\t\te.preventDefault();\r\n\r\n\t\tconst email = $('#emailAddress').val();\r\n\t\tconst key = $('#licenseKey').val();\r\n\r\n\t\tvalidateLicense(email, key);\r\n\t});\r\n}\r\n\r\nasync function setPlatformText() {\r\n\t$('#systemInfo').text(os.type() + \" \" + \" \" + os.platform() + \" \" + \" \" + os.arch() + \" \" + os.release() + \" / Mac Address \" + await getMacAddress());\r\n}\r\n\r\nasync function getMacAddress() {\r\n\tconst interfaces = os.networkInterfaces();\r\n\tlet macAddress = '00:00:00:00:00';\r\n\r\n\tconsole.log(interfaces);\r\n\r\n\tfor (const key in interfaces) {\r\n\t\tif (interfaces.hasOwnProperty('Wi-Fi') ||\r\n\t\t\tinterfaces.hasOwnProperty('en1') ||\r\n\t\t\tinterfaces.hasOwnProperty('wlan0')) {\r\n\t\t\tconst wirelessNetwork = interfaces['Wi-Fi'] || interfaces['en1'] || interfaces['wlan0'];\r\n\t\t\twirelessNetwork.forEach(ifcs => {\r\n\t\t\t\tif (ifcs.hasOwnProperty('mac'))\r\n\t\t\t\t\tmacAddress = ifcs['mac'];\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\treturn macAddress.toUpperCase();\r\n}\r\n\r\nasync function validateLicense(email, licenseKey) {\r\n\tlet signature = _setting.get('signature');\r\n\r\n\tif (signature == undefined || signature == '') {\r\n\t\tconsole.log('Generate a new signature hash.');\r\n\r\n\t\tconst signatureParams = os.hostname() + \"-\" + getMacAddress();\r\n\t\tconst signatureHash = md5(signatureParams);\r\n\r\n\t\t_setting.set('signature', signatureHash);\r\n\r\n\t\tsignature = signatureHash;\r\n\t}\r\n\r\n\tconst baseUrl = _setting.get(\"license_server_url\") || 'https://license.pirantisofthouse.com';\r\n\tconst licenseServerUrl = `${baseUrl}/license-key/get?email=${email}&key=${licenseKey}&signature_hash=${signature}`;\r\n\r\n\ttry {\r\n\t\tconst response = await axios.get(licenseServerUrl);\r\n\t\tconst licenseData = response.data;\r\n\t\tconst status = licenseData.status;\r\n\r\n\t\t_setting.set('user_email', email);\r\n\t\t_setting.set('user_license', licenseKey);\r\n\r\n\t\tif (status === 1)\r\n\t\t\t_ipcRenderer.send('license-updated', \"success\");\r\n\t\telse\r\n\t\t\t_ipcRenderer.send('license-updated', \"failed\");\r\n\t} catch (ex) {\r\n\t\tconsole.log(ex);\r\n\t}\r\n}\r\n\r\nasync function getPageData(url, page) {\r\n\tconsole.log(`Processing ${url}...`);\r\n\r\n\tawait page.goto(url);\r\n\r\n\t//await loadWebViewPage(url);\r\n\r\n\t//Shop Name\r\n\tawait page.waitForSelector(\".x3AX1-LfntMc-header-title-title span\");\r\n\tconst shopName = await page.$eval(\r\n\t\tcssSelector['shop_name'],\r\n\t\t(name) => name.textContent\r\n\t);\r\n\r\n\tawait page.waitForSelector(\".x3AX1-LfntMc-header-title-ij8cu-haAclf\");\r\n\tconst reviewRating = await page.$eval(\r\n\t\tcssSelector['rating'],\r\n\t\t(rating) => rating.textContent\r\n\t);\r\n\r\n\tlet reviewCount = 0;\r\n\ttry {\r\n\t\tawait page.waitForSelector(\".h0ySl-wcwwM-E70qVe-list\");\r\n\t\treviewCount = parseInt(await page.$eval(\r\n\t\t\tcssSelector['reviews'],\r\n\t\t\t(review) => review.textContent\r\n\t\t));\r\n\t} catch (exception) {\r\n\t\tconsole.error(\"No reviews found.\");\r\n\t}\r\n\r\n\t//Shop Address\r\n\tawait page.waitForSelector(\".QSFF4-text.gm2-body-2:nth-child(1)\");\r\n\tlet address = await page.$$eval(\r\n\t\tcssSelector['address'],\r\n\t\t(divs) =>\r\n\t\t\tArray.from(divs)\r\n\t\t\t\t.map((div) => div.innerText)\r\n\t\t\t\t.find((address) => address)\r\n\t);\r\n\r\n\tif (address === undefined) {\r\n\t\taddress = await page.$$eval(\r\n\t\t\tcssSelector['address_backup'],\r\n\t\t\t(divs) => divs[1]\r\n\t\t);\r\n\t}\r\n\r\n\t//Website\r\n\ttry {\r\n\t\tawait page.waitForSelector(cssSelector['website'], { timeout: 3 });\r\n\t} catch (ex) {\r\n\t\tconsole.log('No element found.');\r\n\t}\r\n\r\n\tconst website = await page.$$eval(\r\n\t\tcssSelector['website'],\r\n\t\t(divs) =>\r\n\t\t\tArray.from(divs)\r\n\t\t\t\t.map((div) => div.innerText)\r\n\t\t\t\t.find((link) =>\r\n\t\t\t\t\t/^((https?|ftp|smtp):\\/\\/)?(www.)?[a-z0-9]+(\\.[a-z]{2,}){1,3}(#?\\/?[a-zA-Z0-9#]+)*\\/?(\\?[a-zA-Z0-9-_]+=[a-zA-Z0-9-%]+&?)?$/.test(\r\n\t\t\t\t\t\tlink\r\n\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t);\r\n\r\n\tconsole.log(website || 'No website');\r\n\r\n\tconst phone = await page.$$eval(\r\n\t\tcssSelector['phone'],\r\n\t\t(divs) =>\r\n\t\t\tArray.from(divs)\r\n\t\t\t\t.map((div) => div.innerText)\r\n\t\t\t\t.find((phone) => phone)\r\n\t);\r\n\r\n\tconsole.log(phone || 'No phone');\r\n\r\n\tconst latLong = await getLatLong(url);\r\n\r\n\t//Hours of works\r\n\tconst workHours = await getWorkHours(page);\r\n\r\n\t//Images\r\n\tconst images = await getImages(page);\r\n\r\n\t//Reviews\r\n\tconst allReviews = await getReviews(page);\r\n\r\n\tlet returnObj = {};\r\n\r\n\ttry {\r\n\t\treturnObj = {\r\n\t\t\tshop: shopName.trim(),\r\n\t\t\trating: reviewRating === undefined ? '' : reviewRating.trim(),\r\n\t\t\treviews: reviewCount,\r\n\t\t\taddress: address === undefined ? '' : address.trim(),\r\n\t\t\twebsite: website === undefined ? '' : website.trim(),\r\n\t\t\tphone: phone === undefined ? '' : phone.trim().replace(/\\-/g, ''),\r\n\t\t\tlatitude: latLong[0],\r\n\t\t\tlongitude: latLong[1],\r\n\t\t\tmain_image: images[0],\r\n\t\t\tall_images: images,\r\n\t\t\tall_reviews: allReviews,\r\n\t\t\tworkHours: workHours,\r\n\t\t};\r\n\r\n\t\tconsole.log(returnObj);\r\n\t} catch (exception) {\r\n\t\tconsole.log(exception);\r\n\t}\r\n\r\n\treturn returnObj;\r\n\t//await browser.close();\r\n}\r\n\r\nconst getImages = async (page) => {\r\n\tawait page.waitForSelector('button[jsaction=\"pane.heroHeaderImage.click\"]');\r\n\tawait page.click('button[jsaction=\"pane.heroHeaderImage.click\"]');\r\n\tawait page.waitForNavigation({ waitUntil: \"networkidle0\" });\r\n\r\n\tlet newScrollHeight = 0;\r\n\tlet scrollHeight = _puppeteerConfig['height'] - 200;\r\n\t// let divSelector = \"#pane > div > div > div > div > div:nth-child(4) > div\";\r\n\tlet divSelector = '#pane .siAUzd-neVct.section-scrollbox.cYB2Ge-oHo7ed.cYB2Ge-ti6hGc';\r\n\r\n\twhile (true) {\r\n\t\tawait page.waitForSelector(divSelector);\r\n\r\n\t\tawait page.evaluate(\r\n\t\t\t(scrollHeight, divSelector) =>\r\n\t\t\t\tdocument.querySelector(divSelector).scrollTo(0, scrollHeight),\r\n\t\t\tscrollHeight,\r\n\t\t\tdivSelector\r\n\t\t);\r\n\r\n\t\tawait page.waitForTimeout(800);\r\n\r\n\t\tnewScrollHeight = await page.$eval(\r\n\t\t\tdivSelector,\r\n\t\t\t(div) => div.scrollHeight\r\n\t\t);\r\n\r\n\t\tif (scrollHeight === newScrollHeight) {\r\n\t\t\tbreak;\r\n\t\t} else {\r\n\t\t\tscrollHeight = newScrollHeight;\r\n\t\t}\r\n\t}\r\n\r\n\tconst images = await page.$$eval(\r\n\t\t'a[data-photo-index] div.loaded',\r\n\t\t(divs) => {\r\n\t\t\treturn Array.from(divs)\r\n\t\t\t\t.map((div) => getComputedStyle(div).backgroundImage.replace('url(', '').replace(')', '').replace('\"', ''));\r\n\t\t}\r\n\t);\r\n\r\n\tconsole.log(\"Images: \", images);\r\n\r\n\tawait page.waitForTimeout(2000);\r\n\tawait page.click('button[jsaction=\"pane.topappbar.back;focus:pane.focusTooltip;blur:pane.blurTooltip\"]');\r\n\tawait page.waitForNavigation({ waitUntil: \"networkidle0\" });\r\n\r\n\treturn images;\r\n}\r\n\r\nconst getReviews = async (page) => {\r\n\ttry {\r\n\t\tconst btnTriggerSelector = 'button[jsaction=\"pane.rating.moreReviews\"]';\r\n\r\n\t\tawait page.waitForSelector(btnTriggerSelector, {timeout: 5000});\r\n\t\tawait page.click(btnTriggerSelector);\r\n\t\tawait page.waitForNavigation({ waitUntil: \"networkidle0\" });\r\n\r\n\t\tlet newScrollHeight = 0;\r\n\t\tlet scrollHeight = _puppeteerConfig['height'] - 200;\r\n\t\t// let divSelector = \"#pane > div > div > div > div > div:nth-child(4) > div\";\r\n\t\tlet divSelector = '#pane .siAUzd-neVct.section-scrollbox.cYB2Ge-oHo7ed.cYB2Ge-ti6hGc';\r\n\r\n\t\twhile (true) {\r\n\t\t\tawait page.waitForSelector(divSelector, { timeout: 4000 });\r\n\r\n\t\t\tawait page.evaluate(\r\n\t\t\t\t(scrollHeight, divSelector) =>\r\n\t\t\t\t\tdocument.querySelector(divSelector).scrollTo(0, scrollHeight),\r\n\t\t\t\tscrollHeight,\r\n\t\t\t\tdivSelector\r\n\t\t\t);\r\n\r\n\t\t\tawait page.waitForTimeout(1000);\r\n\r\n\t\t\tnewScrollHeight = await page.$eval(\r\n\t\t\t\tdivSelector,\r\n\t\t\t\t(div) => div.scrollHeight\r\n\t\t\t);\r\n\r\n\t\t\tif (scrollHeight === newScrollHeight) {\r\n\t\t\t\tbreak;\r\n\t\t\t} else {\r\n\t\t\t\tscrollHeight = newScrollHeight;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst reviews = await page.$$eval(\r\n\t\t\t'div.ODSEW-ShBeI-content',\r\n\t\t\t(divs) => Array.from(divs)\r\n\t\t\t\t.map((div) => {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tauthor: div.querySelector('.ODSEW-ShBeI-content .ODSEW-ShBeI-title span').innerText.trim(),\r\n\t\t\t\t\t\tavatar: div.querySelector('.ODSEW-ShBeI-content a[target^=\"_blank\"] img').getAttribute('src').trim(),\r\n\t\t\t\t\t\trating: div.querySelector('.ODSEW-ShBeI-content span.ODSEW-ShBeI-H1e3jb').getAttribute('aria-label').replace('stars').replace('bintang').trim(),\r\n\t\t\t\t\t\tdate: div.querySelector('.ODSEW-ShBeI-content span.ODSEW-ShBeI-RgZmSc-date').innerText.trim(),\r\n\t\t\t\t\t\ttext: div.querySelector('.ODSEW-ShBeI-content .ODSEW-ShBeI-text').innerText.trim(),\r\n\t\t\t\t\t};\r\n\t\t\t\t})\r\n\t\t);\r\n\r\n\t\tconsole.log(moment(datejs('a year ago')).format('YYYY-mm-dd HH:MM:SS'));\r\n\r\n\t\tawait page.waitForTimeout(2000);\r\n\t\tawait page.click('button.VfPpkd-icon-LgbsSe.yHy1rc.eT1oJ');\r\n\t\tawait page.waitForNavigation({ waitUntil: \"networkidle0\" });\r\n\r\n\t\treturn reviews;\r\n\t} catch (ex) {\r\n\t\tconsole.error(\"No reviews found.\");\r\n\t\treturn [];\r\n\t}\r\n}\r\n\r\nconst getWorkHours = async (page) => {\r\n\ttry {\r\n\t\tconst tableSelector = 'table.y0skZc-jyrRxf-Tydcue.NVpwyf-qJTHM-ibL1re';\r\n\r\n\t\tawait page.waitForSelector(tableSelector, {timeout: 5000});\r\n\r\n\t\tconst workHours = await page.$$eval(\r\n\t\t\t`${tableSelector} tr`,\r\n\t\t\t(divs) => Array.from(divs)\r\n\t\t\t\t.map((div) => {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t[div.querySelector('td:nth-child(1)').innerText.trim()]: div.querySelector('td:nth-child(2) ul').innerText.trim(),\r\n\t\t\t\t\t};\r\n\t\t\t\t})\r\n\t\t);\r\n\r\n\t\treturn workHours;\r\n\t} catch (ex) {\r\n\t\tconsole.error(\"No work hours found.\");\r\n\r\n\t\treturn [];\r\n\t}\r\n}\r\n\r\n//Get Links\r\nconst getLinks = async (page) => {\r\n\t// Scrolling to bottom of page\r\n\tlet newScrollHeight = 0;\r\n\tlet scrollHeight = _puppeteerConfig['height'];\r\n\tlet divSelector = '#pane > div > div > div > div > div > div[role=\"region\"]:nth-child(1)';\r\n\r\n\twhile (true) {\r\n\t\tawait page.waitForSelector(divSelector);\r\n\r\n\t\tawait page.evaluate(\r\n\t\t\t(scrollHeight, divSelector) =>\r\n\t\t\t\tdocument.querySelector(divSelector).scrollTo(0, scrollHeight),\r\n\t\t\tscrollHeight,\r\n\t\t\tdivSelector\r\n\t\t);\r\n\r\n\t\tawait page.waitForTimeout(1000);\r\n\r\n\t\tnewScrollHeight = await page.$eval(\r\n\t\t\tdivSelector,\r\n\t\t\t(div) => div.scrollHeight\r\n\t\t);\r\n\r\n\t\tif (scrollHeight === newScrollHeight) {\r\n\t\t\tbreak;\r\n\t\t} else {\r\n\t\t\tscrollHeight = newScrollHeight;\r\n\t\t}\r\n\t}\r\n\r\n\t// Get results\r\n\tconst searchResults = await page.evaluate(() =>\r\n\t\tArray.from(document.querySelectorAll(\"a\"))\r\n\t\t\t.map((el) => el.href)\r\n\t\t\t.filter(\r\n\t\t\t\t(link) =>\r\n\t\t\t\t\tlink.match(/https:\\/\\/www.google.com\\/maps\\//g, link) &&\r\n\t\t\t\t\t!link.match(/\\=https:\\/\\/www.google.com\\/maps\\//g, link)\r\n\t\t\t)\r\n\t);\r\n\r\n\treturn searchResults;\r\n}\r\n\r\nasync function getLatLong(url) {\r\n\tconst latLongStartIndex = url.indexOf('!3d-') + 4;\r\n\tconst latLongEndIndex = url.indexOf('?');\r\n\tconst latLongData = url.substring(latLongStartIndex, latLongEndIndex).replace('!4d', ':');\r\n\r\n\treturn latLongData.split(\":\");\r\n}\r\n\r\nasync function loadWebViewPage(url) {\r\n\tconst webview = document.getElementById('gmapWv');\r\n\tawait webview.loadURL(url);\r\n\r\n\twebview.removeEventListener('dom-ready', loadWebViewPage);\r\n\twebview.addEventListener('dom-ready', loadWebViewPage);\r\n}\r\n\r\nasync function GMapScrapper(searchQuery = \"\", maxLinks = 100) {\r\n\tconsole.log('Start scrapping data.');\r\n\r\n\t// Make sure this variable empty\r\n\tscrapedData = [];\r\n\r\n\t$('#searchBtn').attr('disabled', 'disabled');\r\n\t$('#stopBtn').removeAttr('disabled');\r\n\t$('#restartBtn').removeAttr('disabled');\r\n\t$('span#statusTxt').removeClass('text-success').addClass('text-danger').html('<img src=\"res/images/loader.gif\" width=\"20\" height=\"20\"> Mulai scraping listing...');\r\n\r\n\tconst page = await _puppeteerWrapper.newPage();\r\n\r\n\tconst gmapInitUrl = \"https://www.google.com/maps?t=\" + Date.now(); // + searchQuery.replace(/\\s/g, '+');\r\n\r\n\tawait loadWebViewPage(gmapInitUrl + \"?q=\" + searchQuery.replace(/\\s/g, '+'));\r\n\r\n\tpage.on('response', response => {\r\n\t\tconst status = response.status();\r\n\t\tconsole.log(status)\r\n\t\tif ((status >= 300) && (status <= 399)) {\r\n\t\t\tconsole.log('Redirect from', response.url(), 'to', response.headers()['location'])\r\n\t\t}\r\n\t})\r\n\r\n\ttry {\r\n\t\tawait page.goto(gmapInitUrl, { waitUntil: 'networkidle0' });\r\n\t} catch (ex) {\r\n\t\tconsole.log(ex);\r\n\t\tawait page.waitForTimeout(800);\r\n\t\tawait page.reload({ waitUntil: [\"networkidle0\", \"domcontentloaded\"] });\r\n\t}\r\n\r\n\tawait page.waitForNavigation({ waitUntil: \"domcontentloaded\" });\r\n\tawait page.waitForSelector('div#gs_lc50 input#searchboxinput');\r\n\r\n\tawait page.type('div#gs_lc50 input#searchboxinput', searchQuery, { delay: 10 });\r\n\tawait page.keyboard.press('Enter');\r\n\r\n\tlet allLinks = [];\r\n\tlet linkCount = 0;\r\n\r\n\twhile (\r\n\t\t!(await page.$$eval(\r\n\t\t\t\"#pane > div > div > div > div > div > div > div\",\r\n\t\t\t(elements) =>\r\n\t\t\t\tArray.from(elements).some(\r\n\t\t\t\t\t(el) => (el.innerText === \"Tidak ditemukan hasil\" || el.innerText === \"No results found\")\r\n\t\t\t\t)\r\n\t\t))\r\n\t) {\r\n\t\tif (maxLinks !== 0 && linkCount > maxLinks) break;\r\n\r\n\t\tallLinks.push(...(await getLinks(page)));\r\n\r\n\t\tawait page.$$eval(\"button\", (elements) => {\r\n\t\t\treturn Array.from(elements)\r\n\t\t\t\t.find((el) => (el.getAttribute(\"jsaction\") === \"pane.paginationSection.nextPage\" || el.getAttribute(\"aria-label\") === \"Next page\"))\r\n\t\t\t\t.click()\r\n\t\t});\r\n\r\n\t\ttry {\r\n\t\t\tawait page.waitForNavigation({ waitUntil: \"load\", timeout: 3000 });\r\n\t\t} catch (ex) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tlinkCount = allLinks.length;\r\n\r\n\t\t$('span#statusTxt').removeClass('text-danger').addClass('text-warning').html('<img src=\"res/images/loader.gif\" width=\"20\" height=\"20\"> Mengumpulkan listing...');\r\n\r\n\t\tif (maxLinks == 0) {\r\n\t\t\t$('#resultCountText').text(linkCount);\r\n\t\t} else {\r\n\t\t\t$('#resultCountText').text(linkCount > maxLinks ? maxLinks : linkCount);\r\n\t\t}\r\n\t}\r\n\r\n\t$('#resultsTable tbody').html('<tr><td class=\"text-center\" colspan=\"9\"><p class=\"m-0 p-0\"><img src=\"res/images/loader.gif\" width=\"20\" height=\"20\"> Sedang melakukan validasi listing yang didapat...</p></td></tr>');\r\n\r\n\tconsole.log(\"All Links \", allLinks.length);\r\n\r\n\tlet uniqueLinks = allLinks.filter(function (value, index, self) {\r\n\t\treturn self.indexOf(value) === index;\r\n\t});\r\n\r\n\tif (maxLinks > 0) {\r\n\t\tuniqueLinks = uniqueLinks.slice(0, maxLinks);\r\n\t}\r\n\r\n\t$('span#statusTxt').removeClass('text-warning').addClass('text-success').html('<img src=\"res/images/loader.gif\" width=\"20\" height=\"20\"> Validasi listing...');\r\n\r\n\tawait delay(2000);\r\n\r\n\tconsole.log(\"Filtered Links \", uniqueLinks.length);\r\n\r\n\t$('#resultCountText').text(uniqueLinks.length);\r\n\r\n\tlet no = 1;\r\n\tlet successCount = 0;\r\n\tlet failedCount = 0;\r\n\tfor (let link of uniqueLinks) {\r\n\t\tif (maxLinks !== 0 && no > maxLinks) break;\r\n\r\n\t\t$('span#statusTxt').removeClass('text-warning').addClass('text-success').html('<img src=\"res/images/loader.gif\" width=\"20\" height=\"20\"> #' + no + ' Memproses \"' + link + '\"');\r\n\r\n\t\ttry {\r\n\t\t\tconst data = await getPageData(link, page);\r\n\t\t\tif (no === 1) $('#resultsTable tbody').empty();\r\n\r\n\t\t\t$('#resultsTable tbody').append(`\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<th scope=\"row\">${no}</th>\r\n\t\t\t\t\t<td>${data.shop}</td>\r\n\t\t\t\t\t<td>${data.address}</td>\r\n\t\t\t\t\t<td>${data.phone}</td>\r\n\t\t\t\t\t<td>${data.website}</td>\r\n\t\t\t\t\t<td>${data.rating}</td>\r\n\t\t\t\t\t<td>${data.reviews}</td>\r\n\t\t\t\t\t<td>${data.latitude}</td>\r\n\t\t\t\t\t<td>${data.longitude}</td>\r\n\t\t\t\t</tr>\r\n\t\t\t`);\r\n\t\t\tscrapedData.push(data);\r\n\t\t\tno++;\r\n\t\t\tsuccessCount++;\r\n\t\t} catch (ex) {\r\n\t\t\tfailedCount++;\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tawait delay.range(100, 1000);\r\n\t}\r\n\r\n\t$('#searchBtn').removeAttr('disabled');\r\n\t$('#stopBtn').attr('disabled', 'disabled');\r\n\t$('#restartBtn').attr('disabled', 'disabled');\r\n\r\n\t$('input#searchBusiness').removeAttr('disabled');\r\n\t$('input#searchLimit').removeAttr('disabled');\r\n\r\n\tawait _puppeteerWrapper.cleanup();\r\n\r\n\tconst doneMessage = `Proses scraping dengan kata kunci \"${searchQuery}\" telah selesai dengan statistik berikut: ${successCount} berhasil, ${failedCount} gagal`;\r\n\r\n\t$('span#statusTxt').removeClass('text-danger').addClass('text-success').text(doneMessage);\r\n\r\n\t_ipcRenderer.send('scraping-done', doneMessage);\r\n}\r\n\r\n_ipcRenderer.on('chrome-path-is-set', (event, arg) => {\r\n\t$('span#chromeInfo').addClass('text-success').text(arg);\r\n});\r\n\r\n(async () => {\r\n\ttry {\r\n\t\tconst chromeSet = await _puppeteerWrapper.setup();\r\n\t\tif (!chromeSet) {\r\n\t\t\t_ipcRenderer.send('chrome-not-found');\r\n\t\t} else {\r\n\t\t\t$('span#chromeInfo').addClass('text-success').text(_puppeteerWrapper._getSavedPath());\r\n\t\t}\r\n\r\n\t\tawait main();\r\n\t} catch (e) {\r\n\t\t_logger.logError('Thrown error:');\r\n\t\t_logger.logError(e);\r\n\t} finally {\r\n\t\tawait _puppeteerWrapper.cleanup();\r\n\t}\r\n\r\n\t_logger.logInfo('Done. Close window to exit');\r\n\r\n\tawait _logger.exportLogs(_filePaths.logsPath());\r\n})();\r\n\r\n//#endregion\r\n"]}