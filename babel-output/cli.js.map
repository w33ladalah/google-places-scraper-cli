{"version":3,"sources":["../src/cli.js"],"names":["_logger","Logger","_filePaths","FilePaths","_puppeteerConfig","headless","width","height","args","_puppeteerWrapper","PuppeteerWrapper","scrapedData","main","searchQuery","process","argv","searchLimit","parseInt","GMapScrapper","getPageData","url","page","console","log","goto","waitForSelector","shopName","$eval","cssSelector","name","textContent","reviewRating","rating","reviewCount","review","exception","error","address","$$eval","divs","Array","from","map","div","innerText","find","undefined","timeout","ex","website","link","test","phone","latLong","getLatLong","workHours","getWorkHours","images","getImages","allReviews","getReviews","returnObj","shop","trim","reviews","replace","latitude","longitude","main_image","all_images","all_reviews","click","waitForNavigation","waitUntil","newScrollHeight","scrollHeight","divSelector","evaluate","document","querySelector","scrollTo","waitForTimeout","getComputedStyle","backgroundImage","convertHumanizedDateToEnglish","dateString","replaceString","dateInEnglish","key","Object","hasOwnProperty","call","replacement","btnTriggerSelector","author","avatar","getAttribute","text","date","tableSelector","getLinks","searchResults","querySelectorAll","el","href","filter","match","latLongStartIndex","indexOf","latLongEndIndex","latLongData","substring","split","maxLinks","newPage","gmapInitUrl","Date","now","on","response","status","headers","reload","type","delay","keyboard","press","allLinks","linkCount","elements","some","push","length","uniqueLinks","value","index","self","slice","no","successCount","failedCount","data","range","cleanup","doneMessage","chromeSet","setup","_getSavedPath","e","logError","exportLogs","logsPath"],"mappings":";;AAEA;;AACA;;AACA;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AACA;;AAEA;AAZA;AACA;AAYA,MAAMA,UAAU,IAAIC,eAAJ,EAAhB;AACA,MAAMC,aAAa,IAAIC,qBAAJ,CAAcH,OAAd,EAAuB,eAAvB,CAAnB;AACA,MAAMI,mBAAmB,EAAEC,UAAU,KAAZ,EAAmBC,OAAO,GAA1B,EAA+BC,QAAQ,GAAvC,EAA4CC,MAAM,CAAC,iBAAD,CAAlD,EAAzB;AACA,MAAMC,oBAAoB,IAAIC,mCAAJ,CAAqBV,OAArB,EAA8BE,UAA9B,EAA0CE,gBAA1C,CAA1B;AACA;;AAEA,IAAIO,cAAc,EAAlB;;AAEA;;AAEA,eAAeC,IAAf,GAAsB;AACrB;;AAEA;;AAEA,OAAMC,cAAcC,QAAQC,IAAR,CAAa,CAAb,CAApB;AACA,OAAMC,cAAcC,SAASH,QAAQC,IAAR,CAAa,CAAb,KAAmB,CAA5B,CAApB;;AAEA,OAAMG,aAAaL,WAAb,EAA0BG,WAA1B,CAAN;AACA;;AAED,eAAeG,WAAf,CAA2BC,GAA3B,EAAgCC,IAAhC,EAAsC;AACrCC,SAAQC,GAAR,CAAa,cAAaH,GAAI,KAA9B;;AAEA,OAAMC,KAAKG,IAAL,CAAUJ,GAAV,CAAN;;AAEA;AACA,OAAMC,KAAKI,eAAL,CAAqB,uCAArB,CAAN;AACA,OAAMC,WAAW,MAAML,KAAKM,KAAL,CACtBC,qBAAY,WAAZ,CADsB,EAErBC,IAAD,IAAUA,KAAKC,WAFO,CAAvB;;AAKA,OAAMT,KAAKI,eAAL,CAAqB,yCAArB,CAAN;AACA,OAAMM,eAAe,MAAMV,KAAKM,KAAL,CAC1BC,qBAAY,QAAZ,CAD0B,EAEzBI,MAAD,IAAYA,OAAOF,WAFO,CAA3B;;AAKA,KAAIG,cAAc,CAAlB;AACA,KAAI;AACH,QAAMZ,KAAKI,eAAL,CAAqB,0BAArB,CAAN;AACAQ,gBAAchB,UAAS,MAAMI,KAAKM,KAAL,CAC5BC,qBAAY,SAAZ,CAD4B,EAE3BM,MAAD,IAAYA,OAAOJ,WAFS,CAAf,EAAd;AAIA,EAND,CAME,OAAOK,SAAP,EAAkB;AACnBb,UAAQc,KAAR,CAAc,mBAAd;AACA;;AAED;AACA,OAAMf,KAAKI,eAAL,CAAqB,qCAArB,CAAN;AACA,KAAIY,UAAU,MAAMhB,KAAKiB,MAAL,CACnBV,qBAAY,SAAZ,CADmB,EAElBW,IAAD,IACCC,MAAMC,IAAN,CAAWF,IAAX,EACEG,GADF,CACOC,GAAD,IAASA,IAAIC,SADnB,EAEEC,IAFF,CAEQR,OAAD,IAAaA,OAFpB,CAHkB,CAApB;;AAQA,KAAIA,YAAYS,SAAhB,EAA2B;AAC1BT,YAAU,MAAMhB,KAAKiB,MAAL,CACfV,qBAAY,gBAAZ,CADe,EAEdW,IAAD,IAAUA,KAAK,CAAL,CAFK,CAAhB;AAIA;;AAED;AACA,KAAI;AACH,QAAMlB,KAAKI,eAAL,CAAqBG,qBAAY,SAAZ,CAArB,EAA6C,EAAEmB,SAAS,CAAX,EAA7C,CAAN;AACA,EAFD,CAEE,OAAOC,EAAP,EAAW;AACZ1B,UAAQC,GAAR,CAAY,mBAAZ;AACA;;AAED,OAAM0B,UAAU,MAAM5B,KAAKiB,MAAL,CACrBV,qBAAY,SAAZ,CADqB,EAEpBW,IAAD,IACCC,MAAMC,IAAN,CAAWF,IAAX,EACEG,GADF,CACOC,GAAD,IAASA,IAAIC,SADnB,EAEEC,IAFF,CAEQK,IAAD,IACL,4HAA4HC,IAA5H,CACCD,IADD,CAHF,CAHoB,CAAtB;;AAYA5B,SAAQC,GAAR,CAAY0B,WAAW,YAAvB;;AAEA,OAAMG,QAAQ,MAAM/B,KAAKiB,MAAL,CACnBV,qBAAY,OAAZ,CADmB,EAElBW,IAAD,IACCC,MAAMC,IAAN,CAAWF,IAAX,EACEG,GADF,CACOC,GAAD,IAASA,IAAIC,SADnB,EAEEC,IAFF,CAEQO,KAAD,IAAWA,KAFlB,CAHkB,CAApB;;AAQA9B,SAAQC,GAAR,CAAY6B,SAAS,UAArB;;AAEA,OAAMC,UAAU,MAAMC,WAAWlC,GAAX,CAAtB;;AAEA;AACA,OAAMmC,YAAY,MAAMC,aAAanC,IAAb,CAAxB;;AAEA;AACA,OAAMoC,SAAS,MAAMC,UAAUrC,IAAV,CAArB;;AAEA;AACA,OAAMsC,aAAa,MAAMC,WAAWvC,IAAX,CAAzB;;AAEA,KAAIwC,YAAY,EAAhB;;AAEA,KAAI;AACHA,cAAY;AACXC,SAAMpC,SAASqC,IAAT,EADK;AAEX/B,WAAQD,iBAAiBe,SAAjB,GAA6B,EAA7B,GAAkCf,aAAagC,IAAb,EAF/B;AAGXC,YAAS/B,WAHE;AAIXI,YAASA,YAAYS,SAAZ,GAAwB,EAAxB,GAA6BT,QAAQ0B,IAAR,EAJ3B;AAKXd,YAASA,YAAYH,SAAZ,GAAwB,EAAxB,GAA6BG,QAAQc,IAAR,EAL3B;AAMXX,UAAOA,UAAUN,SAAV,GAAsB,EAAtB,GAA2BM,MAAMW,IAAN,GAAaE,OAAb,CAAqB,KAArB,EAA4B,EAA5B,CANvB;AAOXC,aAAUb,QAAQ,CAAR,CAPC;AAQXc,cAAWd,QAAQ,CAAR,CARA;AASXe,eAAYX,OAAO,CAAP,CATD;AAUXY,eAAYZ,MAVD;AAWXa,gBAAaX,UAXF;AAYXJ,cAAWA;AAZA,GAAZ;;AAeAjC,UAAQC,GAAR,CAAYsC,SAAZ;AACA,EAjBD,CAiBE,OAAO1B,SAAP,EAAkB;AACnBb,UAAQC,GAAR,CAAYY,SAAZ;AACA;;AAED,QAAO0B,SAAP;AACA;;AAED,MAAMH,YAAY,MAAOrC,IAAP,IAAgB;AACjC,OAAMA,KAAKI,eAAL,CAAqB,+CAArB,CAAN;AACA,OAAMJ,KAAKkD,KAAL,CAAW,+CAAX,CAAN;AACA,OAAMlD,KAAKmD,iBAAL,CAAuB,EAAEC,WAAW,cAAb,EAAvB,CAAN;;AAEA,KAAIC,kBAAkB,CAAtB;AACA,KAAIC,eAAevE,iBAAiB,QAAjB,IAA6B,GAAhD;AACA;AACA,KAAIwE,cAAc,mEAAlB;;AAEA,QAAO,IAAP,EAAa;AACZ,QAAMvD,KAAKI,eAAL,CAAqBmD,WAArB,CAAN;;AAEA,QAAMvD,KAAKwD,QAAL,CACL,CAACF,YAAD,EAAeC,WAAf,KACCE,SAASC,aAAT,CAAuBH,WAAvB,EAAoCI,QAApC,CAA6C,CAA7C,EAAgDL,YAAhD,CAFI,EAGLA,YAHK,EAILC,WAJK,CAAN;;AAOA,QAAMvD,KAAK4D,cAAL,CAAoB,GAApB,CAAN;;AAEAP,oBAAkB,MAAMrD,KAAKM,KAAL,CACvBiD,WADuB,EAEtBjC,GAAD,IAASA,IAAIgC,YAFU,CAAxB;;AAKA,MAAIA,iBAAiBD,eAArB,EAAsC;AACrC;AACA,GAFD,MAEO;AACNC,kBAAeD,eAAf;AACA;AACD;;AAED,OAAMjB,SAAS,MAAMpC,KAAKiB,MAAL,CACpB,gCADoB,EAEnBC,IAAD,IAAU;AACT,SAAOC,MAAMC,IAAN,CAAWF,IAAX,EACLG,GADK,CACAC,GAAD,IAASuC,iBAAiBvC,GAAjB,EAAsBwC,eAAtB,CAAsClB,OAAtC,CAA8C,MAA9C,EAAsD,EAAtD,EAA0DA,OAA1D,CAAkE,GAAlE,EAAuE,EAAvE,EAA2EA,OAA3E,CAAmF,GAAnF,EAAwF,EAAxF,CADR,CAAP;AAEA,EALmB,CAArB;;AAQA3C,SAAQC,GAAR,CAAY,UAAZ,EAAwBkC,MAAxB;;AAEA,OAAMpC,KAAK4D,cAAL,CAAoB,IAApB,CAAN;AACA,OAAM5D,KAAKkD,KAAL,CAAW,sFAAX,CAAN;AACA,OAAMlD,KAAKmD,iBAAL,CAAuB,EAAEC,WAAW,cAAb,EAAvB,CAAN;;AAEA,QAAOhB,MAAP;AACA,CAjDD;;AAmDA,MAAM2B,gCAAgCC,cAAc;AACnD,OAAMC,gBAAgB;AACrB,aAAW,QADU;AAErB,aAAW,SAFU;AAGrB,cAAY,QAHS;AAIrB,YAAU,OAJW;AAKrB,WAAS,SALY;AAMrB,aAAW,UANU;AAOrB,WAAS,OAPY;AAQrB,WAAS,QARY;AASrB,YAAU,OATW;AAUrB,UAAQ,MAVa;AAWrB,SAAO,OAXc;AAYrB,WAAS,SAZY;AAarB,UAAQ;AAba,EAAtB;AAeA,KAAIC,gBAAgBF,UAApB;;AAEA,MAAK,MAAMG,GAAX,IAAkBF,aAAlB,EAAiC;AAChC,MAAIG,OAAOC,cAAP,CAAsBC,IAAtB,CAA2BL,aAA3B,EAA0CE,GAA1C,CAAJ,EAAoD;AACnD,SAAMI,cAAcN,cAAcE,GAAd,CAApB;AACAD,mBAAgBA,cAActB,OAAd,CAAsBuB,GAAtB,EAA2BI,WAA3B,CAAhB;AACA;AACD;;AAED,QAAOL,aAAP;AACA,CA1BD;;AA4BA,MAAM3B,aAAa,MAAOvC,IAAP,IAAgB;AAClC,KAAI;AACH,QAAMwE,qBAAqB,4CAA3B;;AAEA,QAAMxE,KAAKI,eAAL,CAAqBoE,kBAArB,EAAyC,EAAC9C,SAAS,IAAV,EAAzC,CAAN;AACA,QAAM1B,KAAKkD,KAAL,CAAWsB,kBAAX,CAAN;AACA,QAAMxE,KAAKmD,iBAAL,CAAuB,EAAEC,WAAW,cAAb,EAAvB,CAAN;;AAEA,MAAIC,kBAAkB,CAAtB;AACA,MAAIC,eAAevE,iBAAiB,QAAjB,IAA6B,GAAhD;AACA;AACA,MAAIwE,cAAc,mEAAlB;;AAEA,SAAO,IAAP,EAAa;AACZ,SAAMvD,KAAKI,eAAL,CAAqBmD,WAArB,EAAkC,EAAE7B,SAAS,IAAX,EAAlC,CAAN;;AAEA,SAAM1B,KAAKwD,QAAL,CACL,CAACF,YAAD,EAAeC,WAAf,KACCE,SAASC,aAAT,CAAuBH,WAAvB,EAAoCI,QAApC,CAA6C,CAA7C,EAAgDL,YAAhD,CAFI,EAGLA,YAHK,EAILC,WAJK,CAAN;;AAOA,SAAMvD,KAAK4D,cAAL,CAAoB,IAApB,CAAN;;AAEAP,qBAAkB,MAAMrD,KAAKM,KAAL,CACvBiD,WADuB,EAEtBjC,GAAD,IAASA,IAAIgC,YAFU,CAAxB;;AAKA,OAAIA,iBAAiBD,eAArB,EAAsC;AACrC;AACA,IAFD,MAEO;AACNC,mBAAeD,eAAf;AACA;AACD;;AAED,QAAMV,UAAU,MAAM3C,KAAKiB,MAAL,CACrB,yBADqB,EAEpBC,IAAD,IAAUC,MAAMC,IAAN,CAAWF,IAAX,EACRG,GADQ,CACHC,GAAD,IAAS;AACb,SAAM2C,gBAAgB;AACrB,eAAW,QADU;AAErB,eAAW,SAFU;AAGrB,gBAAY,QAHS;AAIrB,cAAU,OAJW;AAKrB,aAAS,SALY;AAMrB,eAAW,UANU;AAOrB,aAAS,OAPY;AAQrB,aAAS,QARY;AASrB,cAAU,OATW;AAUrB,YAAQ,MAVa;AAWrB,WAAO,OAXc;AAYrB,aAAS,SAZY;AAarB,YAAQ;AAba,IAAtB;AAeA,OAAIC,gBAAgB5C,IAAIoC,aAAJ,CAAkB,mDAAlB,EAAuEnC,SAAvE,CAAiFmB,IAAjF,EAApB;;AAEA,QAAK,MAAMyB,GAAX,IAAkBF,aAAlB,EAAiC;AAChC,QAAIG,OAAOC,cAAP,CAAsBC,IAAtB,CAA2BL,aAA3B,EAA0CE,GAA1C,CAAJ,EAAoD;AACnD,WAAMI,cAAcN,cAAcE,GAAd,CAApB;AACAD,qBAAgBA,cAActB,OAAd,CAAsBuB,GAAtB,EAA2BI,WAA3B,CAAhB;AACA;AACD;;AAED,UAAO;AACNE,YAAQnD,IAAIoC,aAAJ,CAAkB,8CAAlB,EAAkEnC,SAAlE,CAA4EmB,IAA5E,EADF;AAENgC,YAAQpD,IAAIoC,aAAJ,CAAkB,8CAAlB,EAAkEiB,YAAlE,CAA+E,KAA/E,EAAsFjC,IAAtF,EAFF;AAGN/B,YAAQW,IAAIoC,aAAJ,CAAkB,8CAAlB,EAAkEiB,YAAlE,CAA+E,YAA/E,EAA6F/B,OAA7F,CAAqG,OAArG,EAA8GA,OAA9G,CAAsH,SAAtH,EAAiIF,IAAjI,EAHF;AAINkC,UAAMtD,IAAIoC,aAAJ,CAAkB,wCAAlB,EAA4DnC,SAA5D,CAAsEmB,IAAtE,EAJA;AAKNmC,UAAMX;AALA,IAAP;AAOA,GAjCQ,CAFW,CAAtB;;AAsCA,QAAMlE,KAAK4D,cAAL,CAAoB,IAApB,CAAN;AACA,QAAM5D,KAAKkD,KAAL,CAAW,wCAAX,CAAN;AACA,QAAMlD,KAAKmD,iBAAL,CAAuB,EAAEC,WAAW,cAAb,EAAvB,CAAN;;AAEA,SAAOT,OAAP;AACA,EA/ED,CA+EE,OAAOhB,EAAP,EAAW;AACZ1B,UAAQc,KAAR,CAAcY,EAAd;AACA,SAAO,EAAP;AACA;AACD,CApFD;;AAsFA,MAAMQ,eAAe,MAAOnC,IAAP,IAAgB;AACpC,KAAI;AACH,QAAM8E,gBAAgB,gDAAtB;;AAEA,QAAM9E,KAAKI,eAAL,CAAqB0E,aAArB,EAAoC,EAACpD,SAAS,IAAV,EAApC,CAAN;;AAEA,QAAMQ,YAAY,MAAMlC,KAAKiB,MAAL,CACtB,GAAE6D,aAAc,KADM,EAEtB5D,IAAD,IAAUC,MAAMC,IAAN,CAAWF,IAAX,EACRG,GADQ,CACHC,GAAD,IAAS;AACb,UAAO;AACN,KAACA,IAAIoC,aAAJ,CAAkB,iBAAlB,EAAqCnC,SAArC,CAA+CmB,IAA/C,EAAD,GAAyDpB,IAAIoC,aAAJ,CAAkB,oBAAlB,EAAwCnC,SAAxC,CAAkDmB,IAAlD;AADnD,IAAP;AAGA,GALQ,CAFa,CAAxB;;AAUA,SAAOR,SAAP;AACA,EAhBD,CAgBE,OAAOP,EAAP,EAAW;AACZ1B,UAAQc,KAAR,CAAc,sBAAd;;AAEA,SAAO,EAAP;AACA;AACD,CAtBD;;AAwBA;AACA,MAAMgE,WAAW,MAAO/E,IAAP,IAAgB;AAChC;AACA,KAAIqD,kBAAkB,CAAtB;AACA,KAAIC,eAAevE,iBAAiB,QAAjB,CAAnB;AACA,KAAIwE,cAAc,uEAAlB;;AAEA,QAAO,IAAP,EAAa;AACZ,QAAMvD,KAAKI,eAAL,CAAqBmD,WAArB,CAAN;;AAEA,QAAMvD,KAAKwD,QAAL,CACL,CAACF,YAAD,EAAeC,WAAf,KACCE,SAASC,aAAT,CAAuBH,WAAvB,EAAoCI,QAApC,CAA6C,CAA7C,EAAgDL,YAAhD,CAFI,EAGLA,YAHK,EAILC,WAJK,CAAN;;AAOA,QAAMvD,KAAK4D,cAAL,CAAoB,IAApB,CAAN;;AAEAP,oBAAkB,MAAMrD,KAAKM,KAAL,CACvBiD,WADuB,EAEtBjC,GAAD,IAASA,IAAIgC,YAFU,CAAxB;;AAKA,MAAIA,iBAAiBD,eAArB,EAAsC;AACrC;AACA,GAFD,MAEO;AACNC,kBAAeD,eAAf;AACA;AACD;;AAED;AACA,OAAM2B,gBAAgB,MAAMhF,KAAKwD,QAAL,CAAc,MACzCrC,MAAMC,IAAN,CAAWqC,SAASwB,gBAAT,CAA0B,GAA1B,CAAX,EACE5D,GADF,CACO6D,EAAD,IAAQA,GAAGC,IADjB,EAEEC,MAFF,CAGGvD,IAAD,IACCA,KAAKwD,KAAL,CAAW,mCAAX,EAAgDxD,IAAhD,KACA,CAACA,KAAKwD,KAAL,CAAW,qCAAX,EAAkDxD,IAAlD,CALJ,CAD2B,CAA5B;;AAUA,QAAOmD,aAAP;AACA,CA1CD;;AA4CA,eAAe/C,UAAf,CAA0BlC,GAA1B,EAA+B;AAC9B,OAAMuF,oBAAoBvF,IAAIwF,OAAJ,CAAY,MAAZ,IAAsB,CAAhD;AACA,OAAMC,kBAAkBzF,IAAIwF,OAAJ,CAAY,GAAZ,CAAxB;AACA,OAAME,cAAc1F,IAAI2F,SAAJ,CAAcJ,iBAAd,EAAiCE,eAAjC,EAAkD5C,OAAlD,CAA0D,KAA1D,EAAiE,GAAjE,CAApB;;AAEA,QAAO6C,YAAYE,KAAZ,CAAkB,GAAlB,CAAP;AACA;;AAED,eAAe9F,YAAf,CAA4BL,WAA5B,EAAyCoG,WAAW,GAApD,EAAyD;AACxD3F,SAAQC,GAAR,CAAa,oCAAmCV,WAAY,GAA5D;;AAEA;AACAF,eAAc,EAAd;;AAEA,OAAMU,OAAO,MAAMZ,kBAAkByG,OAAlB,EAAnB;;AAEA,OAAMC,cAAc,mCAAmCC,KAAKC,GAAL,EAAvD;;AAEAhG,MAAKiG,EAAL,CAAQ,UAAR,EAAoBC,YAAY;AAC/B,QAAMC,SAASD,SAASC,MAAT,EAAf;AACA,MAAKA,UAAU,GAAX,IAAoBA,UAAU,GAAlC,EAAwC;AACvClG,WAAQC,GAAR,CAAY,eAAZ,EAA6BgG,SAASnG,GAAT,EAA7B,EAA6C,IAA7C,EAAmDmG,SAASE,OAAT,GAAmB,UAAnB,CAAnD;AACA;AACD,EALD;;AAOA,KAAI;AACH,QAAMpG,KAAKG,IAAL,CAAU2F,WAAV,EAAuB,EAAE1C,WAAW,cAAb,EAAvB,CAAN;AACA,EAFD,CAEE,OAAOzB,EAAP,EAAW;AACZ1B,UAAQC,GAAR,CAAYyB,EAAZ;AACA,QAAM3B,KAAK4D,cAAL,CAAoB,GAApB,CAAN;AACA,QAAM5D,KAAKqG,MAAL,CAAY,EAAEjD,WAAW,CAAC,cAAD,EAAiB,kBAAjB,CAAb,EAAZ,CAAN;AACA;;AAED,OAAMpD,KAAKmD,iBAAL,CAAuB,EAAEC,WAAW,kBAAb,EAAvB,CAAN;AACA,OAAMpD,KAAKI,eAAL,CAAqB,kCAArB,CAAN;;AAEA,OAAMJ,KAAKsG,IAAL,CAAU,kCAAV,EAA8C9G,WAA9C,EAA2D,EAAE+G,OAAO,EAAT,EAA3D,CAAN;AACA,OAAMvG,KAAKwG,QAAL,CAAcC,KAAd,CAAoB,OAApB,CAAN;;AAEA,KAAIC,WAAW,EAAf;AACA,KAAIC,YAAY,CAAhB;;AAEA,QACC,EAAE,MAAM3G,KAAKiB,MAAL,CACP,iDADO,EAEN2F,QAAD,IACCzF,MAAMC,IAAN,CAAWwF,QAAX,EAAqBC,IAArB,CACE3B,EAAD,IAASA,GAAG3D,SAAH,KAAiB,uBAAjB,IAA4C2D,GAAG3D,SAAH,KAAiB,kBADvE,CAHM,CAAR,CADD,EAQE;AACD,MAAIqE,aAAa,CAAb,IAAkBe,YAAYf,QAAlC,EAA4C;;AAE5Cc,WAASI,IAAT,CAAc,IAAI,MAAM/B,SAAS/E,IAAT,CAAV,CAAd;;AAEA,QAAMA,KAAKiB,MAAL,CAAY,QAAZ,EAAuB2F,QAAD,IAAc;AACzC,UAAOzF,MAAMC,IAAN,CAAWwF,QAAX,EACLpF,IADK,CACC0D,EAAD,IAASA,GAAGP,YAAH,CAAgB,UAAhB,MAAgC,iCAAhC,IAAqEO,GAAGP,YAAH,CAAgB,YAAhB,MAAkC,WADhH,EAELzB,KAFK,EAAP;AAGA,GAJK,CAAN;;AAOA,MAAI;AACH,SAAMlD,KAAKmD,iBAAL,CAAuB,EAAEC,WAAW,MAAb,EAAqB1B,SAAS,IAA9B,EAAvB,CAAN;AACA,GAFD,CAEE,OAAOC,EAAP,EAAW;AACZ;AACA;;AAEDgF,cAAYD,SAASK,MAArB;;AAEA9G,UAAQC,GAAR,CAAa,gBAAeyG,SAAU,EAAtC;AACA;;AAED1G,SAAQC,GAAR,CAAY,uBAAZ;;AAEAD,SAAQC,GAAR,CAAY,YAAZ,EAA0BwG,SAASK,MAAnC;;AAEA,KAAIC,cAAcN,SAAStB,MAAT,CAAgB,UAAU6B,KAAV,EAAiBC,KAAjB,EAAwBC,IAAxB,EAA8B;AAC/D,SAAOA,KAAK5B,OAAL,CAAa0B,KAAb,MAAwBC,KAA/B;AACA,EAFiB,CAAlB;;AAIA,KAAItB,WAAW,CAAf,EAAkB;AACjBoB,gBAAcA,YAAYI,KAAZ,CAAkB,CAAlB,EAAqBxB,QAArB,CAAd;AACA;;AAED,OAAM,qBAAM,IAAN,CAAN;;AAEA3F,SAAQC,GAAR,CAAY,iBAAZ,EAA+B8G,YAAYD,MAA3C;;AAEA,KAAIM,KAAK,CAAT;AACA,KAAIC,eAAe,CAAnB;AACA,KAAIC,cAAc,CAAlB;AACA,MAAK,IAAI1F,IAAT,IAAiBmF,WAAjB,EAA8B;AAC7B,MAAIpB,aAAa,CAAb,IAAkByB,KAAKzB,QAA3B,EAAqC;;AAErC3F,UAAQC,GAAR,CAAY,MAAMmH,EAAN,GAAW,gBAAX,GAA8BxF,IAA9B,GAAqC,KAAjD;;AAEA,MAAI;AACH,SAAM2F,OAAO,MAAM1H,YAAY+B,IAAZ,EAAkB7B,IAAlB,CAAnB;;AAEA;;AAEAC,WAAQC,GAAR,CAAY,gBAAZ,EAA8BsH,IAA9B;;AAEAlI,eAAYwH,IAAZ,CAAiBU,IAAjB;;AAEAH;AACAC;AACA,GAXD,CAWE,OAAO3F,EAAP,EAAW;AACZ1B,WAAQc,KAAR,CAAcY,EAAd;AACA4F;AACA;AACA;;AAED,QAAMhB,gBAAMkB,KAAN,CAAY,GAAZ,EAAiB,IAAjB,CAAN;AACA;;AAED,OAAMrI,kBAAkBsI,OAAlB,EAAN;;AAEA,OAAMC,cAAe,0CAAyCnI,WAAY,kCAAiC8H,YAAa,aAAYC,WAAY,SAAhJ;;AAEAtH,SAAQC,GAAR,CAAYyH,WAAZ;AACA;;AAED,CAAC,YAAY;AACZ,KAAI;AACH,QAAMC,YAAY,MAAMxI,kBAAkByI,KAAlB,EAAxB;AACA,MAAI,CAACD,SAAL,EAAgB;AACf3H,WAAQc,KAAR,CAAc,mBAAd;AACA,GAFD,MAEO;AACNd,WAAQC,GAAR,CAAYd,kBAAkB0I,aAAlB,EAAZ;AACA;;AAED,QAAMvI,MAAN;AACA,EATD,CASE,OAAOwI,CAAP,EAAU;AACXpJ,UAAQqJ,QAAR,CAAiB,eAAjB;AACArJ,UAAQqJ,QAAR,CAAiBD,CAAjB;AACA,EAZD,SAYU;AACT,QAAM3I,kBAAkBsI,OAAlB,EAAN;AACA;;AAEDzH,SAAQC,GAAR,CAAY,4BAAZ;;AAEA,OAAMvB,QAAQsJ,UAAR,CAAmBpJ,WAAWqJ,QAAX,EAAnB,CAAN;AACA,CApBD;;AAsBA","file":"cli.js","sourcesContent":["//#region Imports\r\n// Library ----------------------------------------------------------------------------------\r\nimport { Logger } from './lib/logger';\r\nimport { FilePaths } from './lib/file-paths.js';\r\nimport { PuppeteerWrapper } from './lib/puppeteer-wrapper';\r\nimport { CSS_SELECTOR as cssSelector } from './config';\r\nimport $ from 'jquery';\r\nimport delay from 'delay';\r\nimport datejs from 'date.js';\r\nimport moment from 'moment';\r\n//#endregion\r\n\r\n//#region Setup - Dependency Injection-----------------------------------------------\r\nconst _logger = new Logger();\r\nconst _filePaths = new FilePaths(_logger, \"gmap-scrapper\");\r\nconst _puppeteerConfig = { headless: false, width: 900, height: 650, args: ['--lang=en-EN,en'] };\r\nconst _puppeteerWrapper = new PuppeteerWrapper(_logger, _filePaths, _puppeteerConfig);\r\n//#endregion\r\n\r\nlet scrapedData = [];\r\n\r\n//#region Main ---------------------------------------------------------------------\r\n\r\nasync function main() {\r\n\t// console.log(moment(datejs('a year ago')).format('YYYY-MM-DD HH:MM:SS'));\r\n\r\n\t// return;\r\n\r\n\tconst searchQuery = process.argv[2];\r\n\tconst searchLimit = parseInt(process.argv[3] || 5);\r\n\r\n\tawait GMapScrapper(searchQuery, searchLimit);\r\n}\r\n\r\nasync function getPageData(url, page) {\r\n\tconsole.log(`Processing ${url}...`);\r\n\r\n\tawait page.goto(url);\r\n\r\n\t//Shop Name\r\n\tawait page.waitForSelector(\".x3AX1-LfntMc-header-title-title span\");\r\n\tconst shopName = await page.$eval(\r\n\t\tcssSelector['shop_name'],\r\n\t\t(name) => name.textContent\r\n\t);\r\n\r\n\tawait page.waitForSelector(\".x3AX1-LfntMc-header-title-ij8cu-haAclf\");\r\n\tconst reviewRating = await page.$eval(\r\n\t\tcssSelector['rating'],\r\n\t\t(rating) => rating.textContent\r\n\t);\r\n\r\n\tlet reviewCount = 0;\r\n\ttry {\r\n\t\tawait page.waitForSelector(\".h0ySl-wcwwM-E70qVe-list\");\r\n\t\treviewCount = parseInt(await page.$eval(\r\n\t\t\tcssSelector['reviews'],\r\n\t\t\t(review) => review.textContent\r\n\t\t));\r\n\t} catch (exception) {\r\n\t\tconsole.error(\"No reviews found.\");\r\n\t}\r\n\r\n\t//Shop Address\r\n\tawait page.waitForSelector(\".QSFF4-text.gm2-body-2:nth-child(1)\");\r\n\tlet address = await page.$$eval(\r\n\t\tcssSelector['address'],\r\n\t\t(divs) =>\r\n\t\t\tArray.from(divs)\r\n\t\t\t\t.map((div) => div.innerText)\r\n\t\t\t\t.find((address) => address)\r\n\t);\r\n\r\n\tif (address === undefined) {\r\n\t\taddress = await page.$$eval(\r\n\t\t\tcssSelector['address_backup'],\r\n\t\t\t(divs) => divs[1]\r\n\t\t);\r\n\t}\r\n\r\n\t//Website\r\n\ttry {\r\n\t\tawait page.waitForSelector(cssSelector['website'], { timeout: 3 });\r\n\t} catch (ex) {\r\n\t\tconsole.log('No element found.');\r\n\t}\r\n\r\n\tconst website = await page.$$eval(\r\n\t\tcssSelector['website'],\r\n\t\t(divs) =>\r\n\t\t\tArray.from(divs)\r\n\t\t\t\t.map((div) => div.innerText)\r\n\t\t\t\t.find((link) =>\r\n\t\t\t\t\t/^((https?|ftp|smtp):\\/\\/)?(www.)?[a-z0-9]+(\\.[a-z]{2,}){1,3}(#?\\/?[a-zA-Z0-9#]+)*\\/?(\\?[a-zA-Z0-9-_]+=[a-zA-Z0-9-%]+&?)?$/.test(\r\n\t\t\t\t\t\tlink\r\n\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t);\r\n\r\n\tconsole.log(website || 'No website');\r\n\r\n\tconst phone = await page.$$eval(\r\n\t\tcssSelector['phone'],\r\n\t\t(divs) =>\r\n\t\t\tArray.from(divs)\r\n\t\t\t\t.map((div) => div.innerText)\r\n\t\t\t\t.find((phone) => phone)\r\n\t);\r\n\r\n\tconsole.log(phone || 'No phone');\r\n\r\n\tconst latLong = await getLatLong(url);\r\n\r\n\t//Hours of works\r\n\tconst workHours = await getWorkHours(page);\r\n\r\n\t//Images\r\n\tconst images = await getImages(page);\r\n\r\n\t//Reviews\r\n\tconst allReviews = await getReviews(page);\r\n\r\n\tlet returnObj = {};\r\n\r\n\ttry {\r\n\t\treturnObj = {\r\n\t\t\tshop: shopName.trim(),\r\n\t\t\trating: reviewRating === undefined ? '' : reviewRating.trim(),\r\n\t\t\treviews: reviewCount,\r\n\t\t\taddress: address === undefined ? '' : address.trim(),\r\n\t\t\twebsite: website === undefined ? '' : website.trim(),\r\n\t\t\tphone: phone === undefined ? '' : phone.trim().replace(/\\-/g, ''),\r\n\t\t\tlatitude: latLong[0],\r\n\t\t\tlongitude: latLong[1],\r\n\t\t\tmain_image: images[0],\r\n\t\t\tall_images: images,\r\n\t\t\tall_reviews: allReviews,\r\n\t\t\tworkHours: workHours,\r\n\t\t};\r\n\r\n\t\tconsole.log(returnObj);\r\n\t} catch (exception) {\r\n\t\tconsole.log(exception);\r\n\t}\r\n\r\n\treturn returnObj;\r\n}\r\n\r\nconst getImages = async (page) => {\r\n\tawait page.waitForSelector('button[jsaction=\"pane.heroHeaderImage.click\"]');\r\n\tawait page.click('button[jsaction=\"pane.heroHeaderImage.click\"]');\r\n\tawait page.waitForNavigation({ waitUntil: \"networkidle0\" });\r\n\r\n\tlet newScrollHeight = 0;\r\n\tlet scrollHeight = _puppeteerConfig['height'] - 200;\r\n\t// let divSelector = \"#pane > div > div > div > div > div:nth-child(4) > div\";\r\n\tlet divSelector = '#pane .siAUzd-neVct.section-scrollbox.cYB2Ge-oHo7ed.cYB2Ge-ti6hGc';\r\n\r\n\twhile (true) {\r\n\t\tawait page.waitForSelector(divSelector);\r\n\r\n\t\tawait page.evaluate(\r\n\t\t\t(scrollHeight, divSelector) =>\r\n\t\t\t\tdocument.querySelector(divSelector).scrollTo(0, scrollHeight),\r\n\t\t\tscrollHeight,\r\n\t\t\tdivSelector\r\n\t\t);\r\n\r\n\t\tawait page.waitForTimeout(800);\r\n\r\n\t\tnewScrollHeight = await page.$eval(\r\n\t\t\tdivSelector,\r\n\t\t\t(div) => div.scrollHeight\r\n\t\t);\r\n\r\n\t\tif (scrollHeight === newScrollHeight) {\r\n\t\t\tbreak;\r\n\t\t} else {\r\n\t\t\tscrollHeight = newScrollHeight;\r\n\t\t}\r\n\t}\r\n\r\n\tconst images = await page.$$eval(\r\n\t\t'a[data-photo-index] div.loaded',\r\n\t\t(divs) => {\r\n\t\t\treturn Array.from(divs)\r\n\t\t\t\t.map((div) => getComputedStyle(div).backgroundImage.replace('url(', '').replace(')', '').replace('\"', ''));\r\n\t\t}\r\n\t);\r\n\r\n\tconsole.log(\"Images: \", images);\r\n\r\n\tawait page.waitForTimeout(2000);\r\n\tawait page.click('button[jsaction=\"pane.topappbar.back;focus:pane.focusTooltip;blur:pane.blurTooltip\"]');\r\n\tawait page.waitForNavigation({ waitUntil: \"networkidle0\" });\r\n\r\n\treturn images;\r\n}\r\n\r\nconst convertHumanizedDateToEnglish = dateString => {\r\n\tconst replaceString = {\r\n\t\t\"setahun\": \"a year\",\r\n\t\t\"sebulan\": \"a month\",\r\n\t\t\"seminggu\": \"a week\",\r\n\t\t\"sehari\": \"a day\",\r\n\t\t\"sejam\": \"an hour\",\r\n\t\t\"semenit\": \"a minute\",\r\n\t\t\"tahun\": \"years\",\r\n\t\t\"bulan\": \"months\",\r\n\t\t\"minggu\": \"weeks\",\r\n\t\t\"hari\": \"days\",\r\n\t\t\"jam\": \"hours\",\r\n\t\t\"menit\": \"minutes\",\r\n\t\t\"lalu\": \"ago\"\r\n\t};\r\n\tlet dateInEnglish = dateString;\r\n\r\n\tfor (const key in replaceString) {\r\n\t\tif (Object.hasOwnProperty.call(replaceString, key)) {\r\n\t\t\tconst replacement = replaceString[key];\r\n\t\t\tdateInEnglish = dateInEnglish.replace(key, replacement);\r\n\t\t}\r\n\t}\r\n\r\n\treturn dateInEnglish;\r\n};\r\n\r\nconst getReviews = async (page) => {\r\n\ttry {\r\n\t\tconst btnTriggerSelector = 'button[jsaction=\"pane.rating.moreReviews\"]';\r\n\r\n\t\tawait page.waitForSelector(btnTriggerSelector, {timeout: 5000});\r\n\t\tawait page.click(btnTriggerSelector);\r\n\t\tawait page.waitForNavigation({ waitUntil: \"networkidle0\" });\r\n\r\n\t\tlet newScrollHeight = 0;\r\n\t\tlet scrollHeight = _puppeteerConfig['height'] - 200;\r\n\t\t// let divSelector = \"#pane > div > div > div > div > div:nth-child(4) > div\";\r\n\t\tlet divSelector = '#pane .siAUzd-neVct.section-scrollbox.cYB2Ge-oHo7ed.cYB2Ge-ti6hGc';\r\n\r\n\t\twhile (true) {\r\n\t\t\tawait page.waitForSelector(divSelector, { timeout: 4000 });\r\n\r\n\t\t\tawait page.evaluate(\r\n\t\t\t\t(scrollHeight, divSelector) =>\r\n\t\t\t\t\tdocument.querySelector(divSelector).scrollTo(0, scrollHeight),\r\n\t\t\t\tscrollHeight,\r\n\t\t\t\tdivSelector\r\n\t\t\t);\r\n\r\n\t\t\tawait page.waitForTimeout(1000);\r\n\r\n\t\t\tnewScrollHeight = await page.$eval(\r\n\t\t\t\tdivSelector,\r\n\t\t\t\t(div) => div.scrollHeight\r\n\t\t\t);\r\n\r\n\t\t\tif (scrollHeight === newScrollHeight) {\r\n\t\t\t\tbreak;\r\n\t\t\t} else {\r\n\t\t\t\tscrollHeight = newScrollHeight;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst reviews = await page.$$eval(\r\n\t\t\t'div.ODSEW-ShBeI-content',\r\n\t\t\t(divs) => Array.from(divs)\r\n\t\t\t\t.map((div) => {\r\n\t\t\t\t\tconst replaceString = {\r\n\t\t\t\t\t\t\"setahun\": \"a year\",\r\n\t\t\t\t\t\t\"sebulan\": \"a month\",\r\n\t\t\t\t\t\t\"seminggu\": \"a week\",\r\n\t\t\t\t\t\t\"sehari\": \"a day\",\r\n\t\t\t\t\t\t\"sejam\": \"an hour\",\r\n\t\t\t\t\t\t\"semenit\": \"a minute\",\r\n\t\t\t\t\t\t\"tahun\": \"years\",\r\n\t\t\t\t\t\t\"bulan\": \"months\",\r\n\t\t\t\t\t\t\"minggu\": \"weeks\",\r\n\t\t\t\t\t\t\"hari\": \"days\",\r\n\t\t\t\t\t\t\"jam\": \"hours\",\r\n\t\t\t\t\t\t\"menit\": \"minutes\",\r\n\t\t\t\t\t\t\"lalu\": \"ago\"\r\n\t\t\t\t\t};\r\n\t\t\t\t\tlet dateInEnglish = div.querySelector('.ODSEW-ShBeI-content span.ODSEW-ShBeI-RgZmSc-date').innerText.trim();\r\n\r\n\t\t\t\t\tfor (const key in replaceString) {\r\n\t\t\t\t\t\tif (Object.hasOwnProperty.call(replaceString, key)) {\r\n\t\t\t\t\t\t\tconst replacement = replaceString[key];\r\n\t\t\t\t\t\t\tdateInEnglish = dateInEnglish.replace(key, replacement);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tauthor: div.querySelector('.ODSEW-ShBeI-content .ODSEW-ShBeI-title span').innerText.trim(),\r\n\t\t\t\t\t\tavatar: div.querySelector('.ODSEW-ShBeI-content a[target^=\"_blank\"] img').getAttribute('src').trim(),\r\n\t\t\t\t\t\trating: div.querySelector('.ODSEW-ShBeI-content span.ODSEW-ShBeI-H1e3jb').getAttribute('aria-label').replace('stars').replace('bintang').trim(),\r\n\t\t\t\t\t\ttext: div.querySelector('.ODSEW-ShBeI-content .ODSEW-ShBeI-text').innerText.trim(),\r\n\t\t\t\t\t\tdate: dateInEnglish,\r\n\t\t\t\t\t};\r\n\t\t\t\t})\r\n\t\t);\r\n\r\n\t\tawait page.waitForTimeout(2000);\r\n\t\tawait page.click('button.VfPpkd-icon-LgbsSe.yHy1rc.eT1oJ');\r\n\t\tawait page.waitForNavigation({ waitUntil: \"networkidle0\" });\r\n\r\n\t\treturn reviews;\r\n\t} catch (ex) {\r\n\t\tconsole.error(ex);\r\n\t\treturn [];\r\n\t}\r\n}\r\n\r\nconst getWorkHours = async (page) => {\r\n\ttry {\r\n\t\tconst tableSelector = 'table.y0skZc-jyrRxf-Tydcue.NVpwyf-qJTHM-ibL1re';\r\n\r\n\t\tawait page.waitForSelector(tableSelector, {timeout: 5000});\r\n\r\n\t\tconst workHours = await page.$$eval(\r\n\t\t\t`${tableSelector} tr`,\r\n\t\t\t(divs) => Array.from(divs)\r\n\t\t\t\t.map((div) => {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t[div.querySelector('td:nth-child(1)').innerText.trim()]: div.querySelector('td:nth-child(2) ul').innerText.trim(),\r\n\t\t\t\t\t};\r\n\t\t\t\t})\r\n\t\t);\r\n\r\n\t\treturn workHours;\r\n\t} catch (ex) {\r\n\t\tconsole.error(\"No work hours found.\");\r\n\r\n\t\treturn [];\r\n\t}\r\n}\r\n\r\n//Get Links\r\nconst getLinks = async (page) => {\r\n\t// Scrolling to bottom of page\r\n\tlet newScrollHeight = 0;\r\n\tlet scrollHeight = _puppeteerConfig['height'];\r\n\tlet divSelector = '#pane > div > div > div > div > div > div[role=\"region\"]:nth-child(1)';\r\n\r\n\twhile (true) {\r\n\t\tawait page.waitForSelector(divSelector);\r\n\r\n\t\tawait page.evaluate(\r\n\t\t\t(scrollHeight, divSelector) =>\r\n\t\t\t\tdocument.querySelector(divSelector).scrollTo(0, scrollHeight),\r\n\t\t\tscrollHeight,\r\n\t\t\tdivSelector\r\n\t\t);\r\n\r\n\t\tawait page.waitForTimeout(1000);\r\n\r\n\t\tnewScrollHeight = await page.$eval(\r\n\t\t\tdivSelector,\r\n\t\t\t(div) => div.scrollHeight\r\n\t\t);\r\n\r\n\t\tif (scrollHeight === newScrollHeight) {\r\n\t\t\tbreak;\r\n\t\t} else {\r\n\t\t\tscrollHeight = newScrollHeight;\r\n\t\t}\r\n\t}\r\n\r\n\t// Get results\r\n\tconst searchResults = await page.evaluate(() =>\r\n\t\tArray.from(document.querySelectorAll(\"a\"))\r\n\t\t\t.map((el) => el.href)\r\n\t\t\t.filter(\r\n\t\t\t\t(link) =>\r\n\t\t\t\t\tlink.match(/https:\\/\\/www.google.com\\/maps\\//g, link) &&\r\n\t\t\t\t\t!link.match(/\\=https:\\/\\/www.google.com\\/maps\\//g, link)\r\n\t\t\t)\r\n\t);\r\n\r\n\treturn searchResults;\r\n}\r\n\r\nasync function getLatLong(url) {\r\n\tconst latLongStartIndex = url.indexOf('!3d-') + 4;\r\n\tconst latLongEndIndex = url.indexOf('?');\r\n\tconst latLongData = url.substring(latLongStartIndex, latLongEndIndex).replace('!4d', ':');\r\n\r\n\treturn latLongData.split(\":\");\r\n}\r\n\r\nasync function GMapScrapper(searchQuery, maxLinks = 100) {\r\n\tconsole.log(`Start scrapping data with query \"${searchQuery}\"`);\r\n\r\n\t// Make sure this variable empty\r\n\tscrapedData = [];\r\n\r\n\tconst page = await _puppeteerWrapper.newPage();\r\n\r\n\tconst gmapInitUrl = \"https://www.google.com/maps?t=\" + Date.now();\r\n\r\n\tpage.on('response', response => {\r\n\t\tconst status = response.status();\r\n\t\tif ((status >= 300) && (status <= 399)) {\r\n\t\t\tconsole.log('Redirect from', response.url(), 'to', response.headers()['location'])\r\n\t\t}\r\n\t})\r\n\r\n\ttry {\r\n\t\tawait page.goto(gmapInitUrl, { waitUntil: 'networkidle0' });\r\n\t} catch (ex) {\r\n\t\tconsole.log(ex);\r\n\t\tawait page.waitForTimeout(800);\r\n\t\tawait page.reload({ waitUntil: [\"networkidle0\", \"domcontentloaded\"] });\r\n\t}\r\n\r\n\tawait page.waitForNavigation({ waitUntil: \"domcontentloaded\" });\r\n\tawait page.waitForSelector('div#gs_lc50 input#searchboxinput');\r\n\r\n\tawait page.type('div#gs_lc50 input#searchboxinput', searchQuery, { delay: 10 });\r\n\tawait page.keyboard.press('Enter');\r\n\r\n\tlet allLinks = [];\r\n\tlet linkCount = 0;\r\n\r\n\twhile (\r\n\t\t!(await page.$$eval(\r\n\t\t\t\"#pane > div > div > div > div > div > div > div\",\r\n\t\t\t(elements) =>\r\n\t\t\t\tArray.from(elements).some(\r\n\t\t\t\t\t(el) => (el.innerText === \"Tidak ditemukan hasil\" || el.innerText === \"No results found\")\r\n\t\t\t\t)\r\n\t\t))\r\n\t) {\r\n\t\tif (maxLinks !== 0 && linkCount > maxLinks) break;\r\n\r\n\t\tallLinks.push(...(await getLinks(page)));\r\n\r\n\t\tawait page.$$eval(\"button\", (elements) => {\r\n\t\t\treturn Array.from(elements)\r\n\t\t\t\t.find((el) => (el.getAttribute(\"jsaction\") === \"pane.paginationSection.nextPage\" || el.getAttribute(\"aria-label\") === \"Next page\"))\r\n\t\t\t\t.click()\r\n\t\t});\r\n\r\n\r\n\t\ttry {\r\n\t\t\tawait page.waitForNavigation({ waitUntil: \"load\", timeout: 3000 });\r\n\t\t} catch (ex) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tlinkCount = allLinks.length;\r\n\r\n\t\tconsole.log(`Links count: ${linkCount}`);\r\n\t}\r\n\r\n\tconsole.log(\"Validating results...\");\r\n\r\n\tconsole.log(\"All Links \", allLinks.length);\r\n\r\n\tlet uniqueLinks = allLinks.filter(function (value, index, self) {\r\n\t\treturn self.indexOf(value) === index;\r\n\t});\r\n\r\n\tif (maxLinks > 0) {\r\n\t\tuniqueLinks = uniqueLinks.slice(0, maxLinks);\r\n\t}\r\n\r\n\tawait delay(2000);\r\n\r\n\tconsole.log(\"Filtered Links \", uniqueLinks.length);\r\n\r\n\tlet no = 1;\r\n\tlet successCount = 0;\r\n\tlet failedCount = 0;\r\n\tfor (let link of uniqueLinks) {\r\n\t\tif (maxLinks !== 0 && no > maxLinks) break;\r\n\r\n\t\tconsole.log('#' + no + ' Processing: \"' + link + '...');\r\n\r\n\t\ttry {\r\n\t\t\tconst data = await getPageData(link, page);\r\n\r\n\t\t\t// if (no === 1) $('#resultsTable tbody').empty();\r\n\r\n\t\t\tconsole.log(\"Scraped data: \", data);\r\n\r\n\t\t\tscrapedData.push(data);\r\n\r\n\t\t\tno++;\r\n\t\t\tsuccessCount++;\r\n\t\t} catch (ex) {\r\n\t\t\tconsole.error(ex);\r\n\t\t\tfailedCount++;\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tawait delay.range(100, 1000);\r\n\t}\r\n\r\n\tawait _puppeteerWrapper.cleanup();\r\n\r\n\tconst doneMessage = `Done scraping processes with keywords \"${searchQuery}\". Here is the statistic data: ${successCount} success, ${failedCount} failed`;\r\n\r\n\tconsole.log(doneMessage);\r\n}\r\n\r\n(async () => {\r\n\ttry {\r\n\t\tconst chromeSet = await _puppeteerWrapper.setup();\r\n\t\tif (!chromeSet) {\r\n\t\t\tconsole.error(\"Chrome not found!\");\r\n\t\t} else {\r\n\t\t\tconsole.log(_puppeteerWrapper._getSavedPath());\r\n\t\t}\r\n\r\n\t\tawait main();\r\n\t} catch (e) {\r\n\t\t_logger.logError('Thrown error:');\r\n\t\t_logger.logError(e);\r\n\t} finally {\r\n\t\tawait _puppeteerWrapper.cleanup();\r\n\t}\r\n\r\n\tconsole.log('Done. Close window to exit');\r\n\r\n\tawait _logger.exportLogs(_filePaths.logsPath());\r\n})();\r\n\r\n//#endregion\r\n"]}